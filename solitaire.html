<style>*{margin:0}</style><canvas id=c width=960 height=540><script>d=document,g=145,u=95,U=71,V=16,W="#fff",B="#000",G="grey";with(d.getElementById("c").getContext("2d"))a=Array,m=Math,A=m.abs,L=_=>_.length-1,K=_=>[...a(_).keys()],Q=d=>d.slice(1).every((_,i)=>_+1==d[i]),E=d.addEventListener,R=(k,...a)=>{fillStyle=k;fillRect(...a)},T=(x,y,b,c)=>[0,1,2,1,2].map((_,i)=>R(i>2?c:b,x+_,y+2-i%3,U-2*_,u-4+i%3*2)),X=i=>240+i*(U+11),Y=j=>g+j*V,C=(v,i,j,h,d,f)=>{x=d||X(i),y=(f||g)+j*V;T(x,y,h?G:W,h?W:B);fillStyle=h?B:W;font="12px Monospace",fillText(v,x+3,y+12)},D=K(36).map(_=>_%9+1);D.map((_,i)=>(D[i]=D[j=m.random()*++i|0],D[j]=_));D=K(6).map(i=>D.slice(i*6,i*6+6)),S=0,I=0,J=0,O=0,P=0,N=0,M=0,H=a(6),F=a(6),Z=()=>{R(B,0,0,960,540);D.map((d,i)=>{T(X(i),Y(0),G,B);F[i]?T(X(i),Y(0),W,"rgb(20,20,20)"):d.map((c,j)=>!S||i!=I||j<J?C(c,i,j,H[i]&&j==L(d)):0)});S&&D[I].slice(J).map((c,j)=>C(c,I,j,H[I]&&j==L(D[I])-J,N-O,M-P))},E("mousedown",({x,y})=>{z=0;D.map((d,i)=>d.map((_,j)=>!F[i]&&A(X(i)+U/2-x)<U/2&&Y(j)<=y&&y<=Y(j)+(j==L(d)?u:V)&&Q(d.slice(j))?z=[i,j]:0));z&&([I,J]=z,S=1,O=x-X(I),P=y-Y(J),N=x,M=y)}),E("mouseup",({x,y})=>{b=6;D.map((d,i)=>!F[i]&&A(x-O-X(i))<U/2&&A(y-P-Y(m.max(0,L(d))))<u?b=i:0);if(S&&b<6&&I!=b&&!H[b]&&!F[b])v=D[b]==0||D[b][L(D[b])]-1==D[I][J],v||J==L(D[I])&&!H[I]?(v?0:H[b]=1,D[b].push(...D[I].splice(J)),H[I]=0,D[b]=="9,8,7,6,5,4,3,2,1"&&(F[b]=1)):0;S=0,Z()}),E("mousemove",({x,y})=>S&&(Z(),N=x,M=y)),Z()</script>