<body style=margin:0><canvas width=960 height=540><script>d=document,g=145,u=95,U=71,V=16,W="#fff",B="#000",G="grey",a=Array,I=J=O=P=N=M=0,H=a(6),F=a(6),L=_=>_.length-1;$=(_,f)=>_.map(f);with(Math)with(d.body.children[0].getContext`2d`)K=_=>fillStyle=_,A=abs,T=(x,y,b,c)=>$([0,1,2,1,2],(_,i)=>fillRect(K(i>2?c:b)|x+_,y+(z=2-i%3),U-2*_,u-2*z)),X=i=>240+i*(U+11),Y=j=>g+j*V,C=(v,i,j,z,d,f)=>{h=H[i]&&j==z;T(x=d||X(i),y=(f||g)+j*V,h?G:W,h?W:B);K(h?B:W);font="12px Monospace",fillText(v,x+3,y+12)},D=$([...a(36)],(_,i)=>i%9+1),$(D,(_,i)=>(D[i]=D[j=random()*++i|0],D[j]=_)),D=$([...a(6)],i=>D.splice(0,6)),Z=()=>$(D,(d,i)=>F[T(X(i),g,G,B)|i]?T(X(i),g,W,"#222"):$(d,(c,j)=>!O||i-I||j<J?C(c,i,j,L(d)):0),fillRect(K(B)|0,0,960,540))|O&&$(D[I].slice(J),(c,j)=>C(c,I,j,L(D[I])-J,N-O,M-P)),d.onmousedown=({x,y})=>$(D,(d,i)=>$(d,(_,j)=>!F[i]&&A(X(i)+U/2-x)<U/2&&Y(j)<=y&&y<=Y(j)+(j-L(d)?V:u)&&!d.slice(j+1).some((_,i)=>_+1-d[j+i])&&(I=i,J=j,O=x-X(I),P=y-Y(J),N=x,M=y))),d.onmouseup=_=>{$(D,(d,i)=>!F[i]&&A(_.x-O-X(i))<U/2&&A(_.y-P-Y(max(0,L(d))))<u&&I-i&&!H[i]&&!F[i]&&(D[i]==0||D[i][L(D[i])]-1==D[I][J]||J==L(D[I])&&!H[I]&&(H[i]=1))&&(D[i].push(...D[I].splice(J)),H[I]=0,D[i]=="9,8,7,6,5,4,3,2,1"&&(F[i]=1))),O=0,Z()},d.onmousemove=_=>O&&(Z(),N=_.x,M=_.y),Z()</script>