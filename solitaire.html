<style>*{margin:0}</style><canvas width=960 height=540><script>d=document,g=145,u=95,U=71,V=16,W="#fff",B="#000",G="grey",a=Array,S=I=J=O=P=N=M=0,H=a(6),F=a(6),L=_=>_.length-1;with(Math)with(d.body.children[0].getContext`2d`)A=abs,Q=d=>!d.slice(1).some((_,i)=>_+1-d[i]),T=(x,y,b,c)=>[0,1,2,1,2].map((_,i)=>{fillStyle=i>2?c:b,fillRect(x+_,y+2-i%3,U-2*_,u-4+i%3*2)}),X=i=>240+i*(U+11),Y=j=>g+j*V,C=(v,i,j,z,d,f)=>{h=H[i]&&j==z;x=d||X(i),y=(f||g)+j*V;T(x,y,h?G:W,h?W:B);fillStyle=h?B:W;font="12px Monospace",fillText(v,x+3,y+12)},D=[...a(36)].map((_,i)=>i%9+1),D.map((_,i)=>(D[i]=D[j=random()*++i|0],D[j]=_)),D=[...a(6)].map(i=>D.splice(0,6)),Z=()=>{fillStyle=B,fillRect(0,0,960,540),D.map((d,i)=>{T(X(i),g,G,B);F[i]?T(X(i),g,W,"#222"):d.map((c,j)=>!S||i-I||j<J?C(c,i,j,L(d)):0)});S&&D[I].slice(J).map((c,j)=>C(c,I,j,L(D[I])-J,N-O,M-P))},d.onmousedown=({x,y})=>{z=0;D.map((d,i)=>d.map((_,j)=>!F[i]&&A(X(i)+U/2-x)<U/2&&Y(j)<=y&&y<=Y(j)+(j-L(d)?V:u)&&Q(d.slice(j))?z=[i,j]:0));z&&([I,J]=z,S=1,O=x-X(I),P=y-Y(J),N=x,M=y)},d.onmouseup=_=>{b=6;D.map((d,i)=>!F[i]&&A(_.x-O-X(i))<U/2&&A(_.y-P-Y(max(0,L(d))))<u?b=i:0);if(b<6&&I-b&&!H[b]&&!F[b]&&(D[b]==0||D[b][L(D[b])]-1==D[I][J]||J==L(D[I])&&!H[I]&&(H[b]=1)))D[b].push(...D[I].splice(J)),H[I]=0,D[b]=="9,8,7,6,5,4,3,2,1"&&(F[b]=1);S=0,Z()},d.onmousemove=_=>S&&(Z(),N=_.x,M=_.y),Z()</script>